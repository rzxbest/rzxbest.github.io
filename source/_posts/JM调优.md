---
title: jm调优
date: 2022-03-08 09:00:00
tags: [JAVA虚拟机]
categories: [JAVA虚拟机]
top: 100
---
# jm调优

## 遇到了什么问题需要调优？
生产环境新上线了一个系统，莫名其妙奔溃，错误日志报异常OOM

## 类加载过程
加载 -> 验证 -> 准备 -> 解析 -> 初始化 -> 使用 -> 卸载

### 什么情况下会去加载一个类呢?
何时将“.class”字节码文件中加载这个类到JVM内存里来，代码中用到这个类的时候。


### 验证
来校验加载进来的“.class”文件中的内容，是否符合指定的jvm规范。

### 准备
类的类变量(static修饰的变量)分配内存空间，来一个默认的初始值，并非执行赋值

### 解析阶段
符号引用替换为直接引用

### 初始化
执行类变量的赋值语句，执行静态代码块

## 类加载器和双亲委派机制
### 类加载器
- 启动类加载器
Bootstrap ClassLoader，负责加载Java安装目录下的“lib”目录中的核心类库
- 扩展类加载器
Extension ClassLoader，负责加载Java安装目录“lib\ext”目录里面有一些类
- 应用程序类加载器
Application ClassLoader，负责去加载“ClassPath”环境变量所指定的路径中的类 理解为去加载自己写好的Java代码
- 自定义类加载器 除了上面那几种之外，还可以自定义类加载器，去根据自己的需求加载自己的类。
### 双亲委派机制
- JVM的类加载器是有亲子层级结构的，启动类加载器是最上层的，扩展类加载器在第二层，第三层是应用程序类加载器，最后一层是自定义类加载器。
- 双亲委派模型:先找父亲去加载，不行的话再由自己来加载。

## 内存划分
### 方法区（1.8之前） 元空间
将“.class”文件里加载进来的类
### 程序计数器
写好的Java代码会被翻译成字节码，对应各种字节码指令，JVM加载类信息到内存之后，会使用自己的字节码执行引擎执行字节码指令，执行时，JVM里就需要一个特殊的内存区域，那就是“程序计数器”，这个程序计数器就是用来记录当前执行的字节码指令的位置的
### Java虚拟机栈
- JVM必须有一块区域是来保存每个方法内的局部变量等数据的，这个区域就是Java虚拟机栈 
- 每个线程都有自己的Java虚拟机栈
- 如果线程执行了一个方法，就会对这个方法调用创建对应的一个栈帧，栈帧里就有这个方法的局部变量表 、操作数栈、动态链接、方法出口

### Java堆内存
存放代码中创建的各种对象的