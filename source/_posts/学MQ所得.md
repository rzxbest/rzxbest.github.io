---
title: 学MQ所得
date: 2022-02-28 14:59:29
tags: [Mysql]
categories: [Mysql]
---

### 梳理出来自己负责的系统的核心业务流程，核心功能模块，跟其他系统是如何交互的，数据是如何存储，当前已经使用了哪些中间件技术。



### 系统与系统之间的耦合性体现
来思考一个问题，假设促销系统现在有一个接口，专门是让你调用了以后派发优惠券的，现在这个接口接收的参数有 5个，你要是调用这个接口，就必须给他传递5个参数过去，这个是没的说的。
现在问题来了，负责促销系统的工程师某一天突然有一个新的想法，他希望改一改这个接口，在接口调用的时候需要传递7个参数！
一旦他的这个新接口上线了，你还是给他传5个参数，那么他那里就会报错，这个派发优惠券的行为就会失败！
那在这样的一个情况下应该怎么办？
    很简单，你作为订单系统的负责人，必须要配合促销系统去修改代码，既然他要7个参数，那么你就必须得在代码里调用他的接口的时候传递7个参数。
并且你还得配合他的新接口去进行测试以及部署上线，你必须得围绕着他转，配合他。
在这种情况下，就说明你的订单系统跟促销系统是强耦合的

### 订单系统存在的问题

![img.png](aimg.png)

### 消息中间件
异步化提升性能，降低系统耦合，流量削峰

- 解耦异步
    引入MQ之前,a系统调用b系统
    ![img_2.png](aimg_2.png)
    引入MQ之后
    ![img_3.png](aimg_3.png)
- 削峰
    MQ这个技术抗高并发的能力远远高于数据库，同样的机器配置下，如果数据库可以抗每秒6000请求，MQ至少可以抗每秒几万请求。
    ![img_1.png](aimg_1.png)
    MQ进行流量削峰的效果，系统A发送过来的每秒1万请求是一个流量洪峰，然后MQ直接给扛下来了，都存储自己本地磁盘，这个过程就是流量削峰的过程，瞬间把一个洪峰给削下来了，让系统B后续慢慢获取消息来处理。

### kafka rabbitmq rocketmq
- kafka优点
    Kafka的吞吐量几乎是行业里最优秀的，在常规的机器配置下，一台机器 可以达到每秒十几万的QPS
    Kafka性能也很高，发送消息给Kafka都是毫秒级的性能。
    可用性也很高，Kafka是可以支持集群部署的，其中部分机器宕机是可以继续运行的。
- kafka缺点
    丢数据方面的问题，Kafka收到消息之后会写入一个磁盘缓冲区里，并没有直接落地到物理磁盘上去，要是机器本身故障，可能会导致磁盘缓冲区里的数据丢失。
    功能非常的单一，主要是支持发送消息给他，然后从里面消费消息
- kafka使用场景
    Kafka用在用户行为日志的采集和传输上，比如大数据团队要收集APP上用户的一些行为日志，这种日志就是用Kafka来收集和传输的。
    因为那种日志适当丢失数据是没有关系的，而且一般量特别大，要求吞吐量要高，一般就是收发消息，不需要太多的高级功能，所以
Kafka是非常适合这种场景的。
  
