<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.imder.top","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.8.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta property="og:type" content="website">
<meta property="og:title" content="随记">
<meta property="og:url" content="https://blog.imder.top/page/2/index.html">
<meta property="og:site_name" content="随记">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Ren zheng xiao">
<meta property="article:tag" content="JAVA开发">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.imder.top/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>随记</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
  <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas>
   <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
   <script type="text/javascript" src="/js/fireworks.js"></script>
<link rel="alternate" href="/atom.xml" title="随记" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">随记</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记一记,所学,温故而知新</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ren zheng xiao"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Ren zheng xiao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">38</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.imder.top/2022/02/22/springgateway/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Ren zheng xiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/02/22/springgateway/" class="post-title-link" itemprop="url">Springcloud-gateway</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-02-22 10:59:29" itemprop="dateCreated datePublished" datetime="2022-02-22T10:59:29+00:00">2022-02-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2024-03-28 16:43:20" itemprop="dateModified" datetime="2024-03-28T16:43:20+00:00">2024-03-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Springcloud/" itemprop="url" rel="index"><span itemprop="name">Springcloud</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="gateway"><a href="#gateway" class="headerlink" title="gateway"></a>gateway</h1><h2 id="文档地址"><a href="#文档地址" class="headerlink" title="文档地址"></a>文档地址</h2><ul>
<li><a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/multi/multi_spring-cloud-gateway.html">https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.1.0.RELEASE/multi/multi_spring-cloud-gateway.html</a></li>
</ul>
<h2 id="Springcloud通用配置"><a href="#Springcloud通用配置" class="headerlink" title="Springcloud通用配置"></a>Springcloud通用配置</h2><ul>
<li><p>Eureka server 配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server.port=8761</span><br><span class="line">eureka.instance.hostname=localhost</span><br><span class="line">eureka.client.registerWithEureka=false</span><br><span class="line">eureka.client.fetchRegistry=false</span><br><span class="line">eureka.client.serviceUrl.defaultZone:http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span><br></pre></td></tr></table></figure></li>
<li><p>服务配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server.port=8760</span><br><span class="line">spring.application.name=CLOUD-SERVICE</span><br><span class="line">eureka.instance.hostname=localhost</span><br><span class="line">eureka.client.registerWithEureka=true</span><br><span class="line">eureka.client.fetchRegistry=true</span><br><span class="line">eureka.client.serviceUrl.defaultZone:http://$&#123;eureka.instance.hostname&#125;:8761/eureka/</span><br></pre></td></tr></table></figure></li>
<li><p>网关配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server.port=8088</span><br><span class="line">spring.application.name=CLOUD-GATEWAY</span><br><span class="line">eureka.instance.hostname=localhost</span><br><span class="line">eureka.client.registerWithEureka=true</span><br><span class="line">eureka.client.fetchRegistry=true</span><br><span class="line">eureka.client.serviceUrl.defaultZone:http://$&#123;eureka.instance.hostname&#125;:8761/eureka/</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="以服务名为前缀访问服务接口"><a href="#以服务名为前缀访问服务接口" class="headerlink" title="以服务名为前缀访问服务接口"></a>以服务名为前缀访问服务接口</h2><ul>
<li>在网关配置加入<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.gateway.discovery.locator.enabled=true</span><br></pre></td></tr></table></figure>
<img src="/2022/02/22/springgateway/img.png" alt="img.png"></li>
</ul>
<h2 id="predicates断言路由"><a href="#predicates断言路由" class="headerlink" title="predicates断言路由"></a>predicates断言路由</h2><ul>
<li>在网关配置中加入以下配置<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.gateway.routes[0].id= 1</span><br><span class="line">spring.cloud.gateway.routes[0].uri=http://localhost:8760</span><br><span class="line">spring.cloud.gateway.routes[0].predicates[0]=Path=/demo/**</span><br></pre></td></tr></table></figure>
<img src="/2022/02/22/springgateway/img2.png" alt="img2.png"></li>
</ul>
<h2 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h2><ul>
<li>加入以下配置<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring.cloud.gateway.routes[0].filters[0].name=AddRequestParameter</span><br><span class="line">spring.cloud.gateway.routes[0].filters[0].args[name]=token</span><br><span class="line">spring.cloud.gateway.routes[0].filters[0].args[value]=abcdef</span><br></pre></td></tr></table></figure>
<img src="/2022/02/22/springgateway/img11.png" alt="img11.png"></li>
</ul>
<h2 id="过滤器对结果进行处理"><a href="#过滤器对结果进行处理" class="headerlink" title="过滤器对结果进行处理"></a>过滤器对结果进行处理</h2><ul>
<li>对结果进行处理</li>
<li>官方文档提供的 modifyResponseBody过滤器</li>
</ul>
<p><img src="/2022/02/22/springgateway/img12.png" alt="img12.png"></p>
<p>添加Java配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public RouteLocator routes(RouteLocatorBuilder builder,ObjectMapper mapper) &#123;</span><br><span class="line">return builder.routes()</span><br><span class="line">.route(&quot;id2&quot;, r -&gt; r.path(&quot;/modify/**&quot;)</span><br><span class="line">.filters(gatewayFilterSpec-&gt; &#123;</span><br><span class="line">gatewayFilterSpec.modifyResponseBody(String.class,String.class,(exchange,s) -&gt;&#123;</span><br><span class="line">String result = s;</span><br><span class="line">try&#123;</span><br><span class="line">Map map = mapper.readValue(s, Map.class);</span><br><span class="line">map.put(&quot;add&quot;,&quot;this is modify&quot;);</span><br><span class="line">result = mapper.writeValueAsString(map);</span><br><span class="line">&#125;catch (Exception e)&#123;</span><br><span class="line">&#125;</span><br><span class="line">return  Mono.just(result); &#125;</span><br><span class="line">);</span><br><span class="line">return gatewayFilterSpec;</span><br><span class="line">&#125;).uri(URI.create(&quot;http://localhost:8760&quot;))).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果</p>
<p><img src="/2022/02/22/springgateway/img13.png" alt="img13.png"></p>
<h2 id="全局过滤器"><a href="#全局过滤器" class="headerlink" title="全局过滤器"></a>全局过滤器</h2><h3 id="自定义全局过滤器"><a href="#自定义全局过滤器" class="headerlink" title="自定义全局过滤器"></a>自定义全局过滤器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">@Order(-1)</span><br><span class="line">public GlobalFilter a() &#123;</span><br><span class="line">    return (exchange, chain) -&gt; &#123;</span><br><span class="line">        if (exchange.getRequest().getQueryParams().containsKey(&quot;token&quot;))&#123;</span><br><span class="line">            return chain.filter(exchange).doOnSuccess(s-&gt;&#123;</span><br><span class="line">            exchange.getResponse().getHeaders().add(&quot;token&quot;,exchange.getRequest().getQueryParams().get(&quot;token&quot;).get(0));</span><br><span class="line">        &#125;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return chain.filter(exchange);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>或者实现GlobalFilter、 Order接口<br><img src="/2022/02/22/springgateway/img14.png" alt="img14.png"><br><img src="/2022/02/22/springgateway/img15.png" alt="img15.png"></p>
<h2 id="接入actuator"><a href="#接入actuator" class="headerlink" title="接入actuator"></a>接入actuator</h2><h3 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h2 id="添加配置"><a href="#添加配置" class="headerlink" title="添加配置"></a>添加配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">management.endpoint.gateway.enabled=true</span><br><span class="line">management.endpoints.web.exposure.include=gateway</span><br></pre></td></tr></table></figure>
<h2 id="访问地址"><a href="#访问地址" class="headerlink" title="访问地址"></a>访问地址</h2><ul>
<li>/actuator/gateway/globalfilters</li>
<li>/actuator/gateway/routefilters</li>
<li>/actuator/gateway/refresh</li>
<li>/actuator/gateway/routes</li>
<li>/actuator/gateway/routes/{id}</li>
<li>POST request to /gateway/routes/{id_route_to_create}</li>
<li>DELETE request to /gateway/routes/{id_route_to_delete}.</li>
</ul>
<h3 id="自定义Filter"><a href="#自定义Filter" class="headerlink" title="自定义Filter"></a>自定义Filter</h3><ul>
<li>实现GatewayFilterFactory 或者继承AbstractGatewayFilterFactory<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class AddResponseHeaderGatewayFilterFactory extends AbstractNameValueGatewayFilterFactory &#123;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public GatewayFilter apply(NameValueConfig config) &#123;</span><br><span class="line">return new GatewayFilter() &#123;</span><br><span class="line">@Override</span><br><span class="line">public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;</span><br><span class="line">String value = ServerWebExchangeUtils.expand(exchange, config.getValue());</span><br><span class="line">exchange.getResponse().getHeaders().add(config.getName(), value);</span><br><span class="line"></span><br><span class="line">            return chain.filter(exchange);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         @Override</span><br><span class="line">         public String toString() &#123;</span><br><span class="line">            return filterToStringCreator(AddResponseHeaderGatewayFilterFactory.this)</span><br><span class="line">                  .append(config.getName(), config.getValue()).toString();</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.imder.top/2022/02/21/@ControllerAdvice%E4%B8%8E@ModelAttribute%E3%80%81@InitBinder%E6%B3%A8%E8%A7%A3%E6%B7%B7%E5%90%88%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Ren zheng xiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/02/21/@ControllerAdvice%E4%B8%8E@ModelAttribute%E3%80%81@InitBinder%E6%B3%A8%E8%A7%A3%E6%B7%B7%E5%90%88%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">ExceptionHandler和ControllerAdvice注解分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-02-21 19:59:29" itemprop="dateCreated datePublished" datetime="2022-02-21T19:59:29+00:00">2022-02-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2024-03-28 16:43:20" itemprop="dateModified" datetime="2024-03-28T16:43:20+00:00">2024-03-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JAVA/" itemprop="url" rel="index"><span itemprop="name">JAVA</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JAVA/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ControllerAdvice与-ModelAttribute、-InitBinder注解混合使用"><a href="#ControllerAdvice与-ModelAttribute、-InitBinder注解混合使用" class="headerlink" title="@ControllerAdvice与@ModelAttribute、@InitBinder注解混合使用"></a>@ControllerAdvice与@ModelAttribute、@InitBinder注解混合使用</h1><h2 id="ModelAttribute注解的作用"><a href="#ModelAttribute注解的作用" class="headerlink" title="@ModelAttribute注解的作用"></a>@ModelAttribute注解的作用</h2><ul>
<li>用在方法的参数上<ul>
<li>注解在参数上，会将客户端传递过来的参数按名称注入到指定对象中，</li>
<li>并且会将这个对象自动加入ModelMap中</li>
</ul>
</li>
<li>用在Controller的方法上<ul>
<li>注解在方法上，会在每一个@RequestMapping标注的方法前执行，</li>
<li>如果有返回值，则自动将该返回值加入到ModelMap中</li>
</ul>
</li>
</ul>
<h2 id="InitBinder注解混合使用"><a href="#InitBinder注解混合使用" class="headerlink" title="@InitBinder注解混合使用"></a>@InitBinder注解混合使用</h2><ul>
<li>对数据绑定进行设置<br>  WebDataBinder中有很多方法可以对数据绑定进行具体的设置<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@InitBinder</span><br><span class="line">public void initBinder(WebDataBinder binder) &#123;</span><br><span class="line">	binder.setDisallowedFields(&quot;name&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li>注册已有封装好的编辑器<ul>
<li>由于前台传到controller里的值是String类型的，当往Model里Set这个值的时候，如果set的这个属性是个对象，Spring就会去找到对应的editor进行转换，然后再set进去</li>
<li>Spring自己提供了大量的实现类（如下图所示的在org.springframwork.beans.propertyEditors下的所有editor），诸如CustomDateEditor ，CustomBooleanEditor，CustomNumberEditor等许多，基本上够用</li>
</ul>
</li>
</ul>
<h2 id="如何加载-RequestMappingHandlerAdapter？"><a href="#如何加载-RequestMappingHandlerAdapter？" class="headerlink" title="如何加载    RequestMappingHandlerAdapter？"></a>如何加载    RequestMappingHandlerAdapter？</h2><p>自己注入或者使用默认的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">private void initHandlerAdapters(ApplicationContext context) &#123;</span><br><span class="line">	this.handlerAdapters = null;</span><br><span class="line"></span><br><span class="line">	if (this.detectAllHandlerAdapters) &#123; //true</span><br><span class="line">		// Find all HandlerAdapters in the ApplicationContext, including ancestor contexts.</span><br><span class="line">		Map&lt;String, HandlerAdapter&gt; matchingBeans =</span><br><span class="line">				BeanFactoryUtils.beansOfTypeIncludingAncestors(context, HandlerAdapter.class, true, false);//从容器中获取HandlerAdapter.class</span><br><span class="line">		if (!matchingBeans.isEmpty()) &#123;</span><br><span class="line">			this.handlerAdapters = new ArrayList&lt;&gt;(matchingBeans.values());</span><br><span class="line">			// We keep HandlerAdapters in sorted order.</span><br><span class="line">			AnnotationAwareOrderComparator.sort(this.handlerAdapters);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	else &#123;</span><br><span class="line">		try &#123;</span><br><span class="line">			HandlerAdapter ha = context.getBean(HANDLER_ADAPTER_BEAN_NAME, HandlerAdapter.class);</span><br><span class="line">			this.handlerAdapters = Collections.singletonList(ha);</span><br><span class="line">		&#125;</span><br><span class="line">		catch (NoSuchBeanDefinitionException ex) &#123;</span><br><span class="line">			// Ignore, we&#x27;ll add a default HandlerAdapter later.</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// Ensure we have at least some HandlerAdapters, by registering</span><br><span class="line">	// default HandlerAdapters if no other adapters are found.</span><br><span class="line">	if (this.handlerAdapters == null) &#123;</span><br><span class="line">		this.handlerAdapters = getDefaultStrategies(context, HandlerAdapter.class);//从DispatchServlet.properties中获取</span><br><span class="line">		if (logger.isTraceEnabled()) &#123;</span><br><span class="line">			logger.trace(&quot;No HandlerAdapters declared for servlet &#x27;&quot; + getServletName() +</span><br><span class="line">					&quot;&#x27;: using default strategies from DispatcherServlet.properties&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<h2 id="DispatchServlet-properties中获取HandlerAdapter"><a href="#DispatchServlet-properties中获取HandlerAdapter" class="headerlink" title="DispatchServlet.properties中获取HandlerAdapter"></a>DispatchServlet.properties中获取HandlerAdapter</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.web.servlet.HandlerAdapter=org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,\</span><br><span class="line">	org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,\</span><br><span class="line">	org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter,\</span><br><span class="line">	org.springframework.web.servlet.function.support.HandlerFunctionAdapter</span><br></pre></td></tr></table></figure>

<h2 id="何时加载-ControllerAdvice与-ModelAttribute、-InitBinder注解？"><a href="#何时加载-ControllerAdvice与-ModelAttribute、-InitBinder注解？" class="headerlink" title="何时加载@ControllerAdvice与@ModelAttribute、@InitBinder注解？"></a>何时加载@ControllerAdvice与@ModelAttribute、@InitBinder注解？</h2><p>RequestMappingHandlerAdapter类实现了InitializingBean接口，在afterPropertiesSet方法中initControllerAdviceCache方法中加载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">public static final MethodFilter INIT_BINDER_METHODS = method -&gt;</span><br><span class="line">			AnnotatedElementUtils.hasAnnotation(method, InitBinder.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public static final MethodFilter MODEL_ATTRIBUTE_METHODS = method -&gt;</span><br><span class="line">		(!AnnotatedElementUtils.hasAnnotation(method, RequestMapping.class) &amp;&amp;</span><br><span class="line">				AnnotatedElementUtils.hasAnnotation(method, ModelAttribute.class));</span><br><span class="line"></span><br><span class="line">private void initControllerAdviceCache() &#123;</span><br><span class="line">	if (getApplicationContext() == null) &#123;</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//从容器中获取ControllerAdvice注解的bean</span><br><span class="line">	List&lt;ControllerAdviceBean&gt; adviceBeans = ControllerAdviceBean.findAnnotatedBeans(getApplicationContext());</span><br><span class="line"></span><br><span class="line">	List&lt;Object&gt; requestResponseBodyAdviceBeans = new ArrayList&lt;&gt;();</span><br><span class="line">	//遍历每个bean,找出InitBinder注解的方法放入initBinderAdviceCache里，找出ModelAttribute注解的方法放入modelAttributeAdviceCache</span><br><span class="line">	for (ControllerAdviceBean adviceBean : adviceBeans) &#123;</span><br><span class="line">		Class&lt;?&gt; beanType = adviceBean.getBeanType();</span><br><span class="line">		if (beanType == null) &#123;</span><br><span class="line">			throw new IllegalStateException(&quot;Unresolvable type for ControllerAdviceBean: &quot; + adviceBean);</span><br><span class="line">		&#125;</span><br><span class="line">		Set&lt;Method&gt; attrMethods = MethodIntrospector.selectMethods(beanType, MODEL_ATTRIBUTE_METHODS);</span><br><span class="line">		if (!attrMethods.isEmpty()) &#123;</span><br><span class="line">			this.modelAttributeAdviceCache.put(adviceBean, attrMethods);</span><br><span class="line">		&#125;</span><br><span class="line">		Set&lt;Method&gt; binderMethods = MethodIntrospector.selectMethods(beanType, INIT_BINDER_METHODS);</span><br><span class="line">		if (!binderMethods.isEmpty()) &#123;</span><br><span class="line">			this.initBinderAdviceCache.put(adviceBean, binderMethods);</span><br><span class="line">		&#125;</span><br><span class="line">		if (RequestBodyAdvice.class.isAssignableFrom(beanType) || ResponseBodyAdvice.class.isAssignableFrom(beanType)) &#123;</span><br><span class="line">			requestResponseBodyAdviceBeans.add(adviceBean);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	...省略</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="何时调用-ModelAttribute、-InitBinder注解的方法或参数？"><a href="#何时调用-ModelAttribute、-InitBinder注解的方法或参数？" class="headerlink" title="何时调用 @ModelAttribute、@InitBinder注解的方法或参数？"></a>何时调用 @ModelAttribute、@InitBinder注解的方法或参数？</h2><ul>
<li>在RequestMappingHandlerAdapter对象调用handle方法中调用</li>
<li>handle方法调用handleInternal方法,handleInternal方法调用invokeHandlerMethod方法</li>
<li>invokeHandlerMethod 方法中getDataBinderFactory方法获取InitBinder注解的方法</li>
<li>invokeHandlerMethod 方法中getModelFactory方法获取ModelAttribute注解的方法</li>
<li>调用ModelFactory对象的initModel方法，initModel方法中调用invokeModelAttributeMethods方法，调用@ModelAttribute注解的方法</li>
<li>调用ModelFactory对象的initModel方法，initModel方法中调用findSessionAttributeArguments方法，对@ModelAttribute注解的参数赋值</li>
<li>invocableMethod.invokeAndHandle(webRequest, mavContainer)，在这个方法中调用invokeForRequest(),invokeForRequest()中调用getMethodArgumentValues()方法对参数进行了绑定</li>
</ul>
<h2 id="getDataBinderFactory方法-getModelFactory方法"><a href="#getDataBinderFactory方法-getModelFactory方法" class="headerlink" title="getDataBinderFactory方法 getModelFactory方法"></a>getDataBinderFactory方法 getModelFactory方法</h2><ul>
<li>先从controller类获取@InitBinder注解的方法</li>
<li>在从@ControllerAdvice注解的bean上获取@InitBinder注解的方法</li>
<li>上述的方法组合并返回ModelFactory</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">private WebDataBinderFactory getDataBinderFactory(HandlerMethod handlerMethod) throws Exception &#123;</span><br><span class="line">	Class&lt;?&gt; handlerType = handlerMethod.getBeanType();</span><br><span class="line">	Set&lt;Method&gt; methods = this.initBinderCache.get(handlerType);</span><br><span class="line">	if (methods == null) &#123;</span><br><span class="line">		methods = MethodIntrospector.selectMethods(handlerType, INIT_BINDER_METHODS);</span><br><span class="line">		this.initBinderCache.put(handlerType, methods);</span><br><span class="line">	&#125;</span><br><span class="line">	List&lt;InvocableHandlerMethod&gt; initBinderMethods = new ArrayList&lt;&gt;();</span><br><span class="line">	// Global methods first</span><br><span class="line">	this.initBinderAdviceCache.forEach((controllerAdviceBean, methodSet) -&gt; &#123;</span><br><span class="line">		if (controllerAdviceBean.isApplicableToBeanType(handlerType)) &#123;</span><br><span class="line">			Object bean = controllerAdviceBean.resolveBean();</span><br><span class="line">			for (Method method : methodSet) &#123;</span><br><span class="line">				initBinderMethods.add(createInitBinderMethod(bean, method));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	for (Method method : methods) &#123;</span><br><span class="line">		Object bean = handlerMethod.getBean();</span><br><span class="line">		initBinderMethods.add(createInitBinderMethod(bean, method));</span><br><span class="line">	&#125;</span><br><span class="line">	return createDataBinderFactory(initBinderMethods);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>先从controller类获取@ModelAttribute注解的方法</li>
<li>在从@ControllerAdvice注解的bean上获取@ModelAttribute注解的方法</li>
<li>上述的方法组合并返回ModelFactory<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">private ModelFactory getModelFactory(HandlerMethod handlerMethod, WebDataBinderFactory binderFactory) &#123;</span><br><span class="line">	SessionAttributesHandler sessionAttrHandler = getSessionAttributesHandler(handlerMethod);</span><br><span class="line">	Class&lt;?&gt; handlerType = handlerMethod.getBeanType();</span><br><span class="line">	Set&lt;Method&gt; methods = this.modelAttributeCache.get(handlerType);</span><br><span class="line">	if (methods == null) &#123;</span><br><span class="line">		methods = MethodIntrospector.selectMethods(handlerType, MODEL_ATTRIBUTE_METHODS);</span><br><span class="line">		this.modelAttributeCache.put(handlerType, methods);</span><br><span class="line">	&#125;</span><br><span class="line">	List&lt;InvocableHandlerMethod&gt; attrMethods = new ArrayList&lt;&gt;();</span><br><span class="line">	// Global methods first</span><br><span class="line">	this.modelAttributeAdviceCache.forEach((controllerAdviceBean, methodSet) -&gt; &#123;</span><br><span class="line">		if (controllerAdviceBean.isApplicableToBeanType(handlerType)) &#123;</span><br><span class="line">			Object bean = controllerAdviceBean.resolveBean();</span><br><span class="line">			for (Method method : methodSet) &#123;</span><br><span class="line">				attrMethods.add(createModelAttributeMethod(binderFactory, bean, method));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">	for (Method method : methods) &#123;</span><br><span class="line">		Object bean = handlerMethod.getBean();</span><br><span class="line">		attrMethods.add(createModelAttributeMethod(binderFactory, bean, method));</span><br><span class="line">	&#125;</span><br><span class="line">	return new ModelFactory(attrMethods, binderFactory, sessionAttrHandler);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="invokeModelAttributeMethods方法"><a href="#invokeModelAttributeMethods方法" class="headerlink" title="invokeModelAttributeMethods方法"></a>invokeModelAttributeMethods方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private void invokeModelAttributeMethods(NativeWebRequest request, ModelAndViewContainer container)</span><br><span class="line">			throws Exception &#123;</span><br><span class="line"></span><br><span class="line">	while (!this.modelMethods.isEmpty()) &#123;</span><br><span class="line">		InvocableHandlerMethod modelMethod = getNextModelMethod(container).getHandlerMethod();</span><br><span class="line">		ModelAttribute ann = modelMethod.getMethodAnnotation(ModelAttribute.class);</span><br><span class="line">		Assert.state(ann != null, &quot;No ModelAttribute annotation&quot;);</span><br><span class="line">		if (container.containsAttribute(ann.name())) &#123;</span><br><span class="line">			if (!ann.binding()) &#123;</span><br><span class="line">				container.setBindingDisabled(ann.name());</span><br><span class="line">			&#125;</span><br><span class="line">			continue;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		Object returnValue = modelMethod.invokeForRequest(request, container);</span><br><span class="line">		if (modelMethod.isVoid()) &#123;</span><br><span class="line">			if (StringUtils.hasText(ann.value())) &#123;</span><br><span class="line">				if (logger.isDebugEnabled()) &#123;</span><br><span class="line">					logger.debug(&quot;Name in @ModelAttribute is ignored because method returns void: &quot; +</span><br><span class="line">							modelMethod.getShortLogMessage());</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			continue;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		String returnValueName = getNameForReturnValue(returnValue, modelMethod.getReturnType());</span><br><span class="line">		if (!ann.binding()) &#123;</span><br><span class="line">			container.setBindingDisabled(returnValueName);</span><br><span class="line">		&#125;</span><br><span class="line">		if (!container.containsAttribute(returnValueName)) &#123;</span><br><span class="line">			container.addAttribute(returnValueName, returnValue);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="findSessionAttributeArguments方法"><a href="#findSessionAttributeArguments方法" class="headerlink" title="findSessionAttributeArguments方法"></a>findSessionAttributeArguments方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">private List&lt;String&gt; findSessionAttributeArguments(HandlerMethod handlerMethod) &#123;</span><br><span class="line">	List&lt;String&gt; result = new ArrayList&lt;&gt;();</span><br><span class="line">	for (MethodParameter parameter : handlerMethod.getMethodParameters()) &#123;</span><br><span class="line">		if (parameter.hasParameterAnnotation(ModelAttribute.class)) &#123;</span><br><span class="line">			String name = getNameForParameter(parameter);</span><br><span class="line">			Class&lt;?&gt; paramType = parameter.getParameterType();</span><br><span class="line">			if (this.sessionAttributesHandler.isHandlerSessionAttribute(name, paramType)) &#123;</span><br><span class="line">				result.add(name);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="getMethodArgumentValues方法"><a href="#getMethodArgumentValues方法" class="headerlink" title="getMethodArgumentValues方法"></a>getMethodArgumentValues方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">protected Object[] getMethodArgumentValues(NativeWebRequest request, @Nullable ModelAndViewContainer mavContainer,</span><br><span class="line">			Object... providedArgs) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">	MethodParameter[] parameters = getMethodParameters();</span><br><span class="line">	if (ObjectUtils.isEmpty(parameters)) &#123;</span><br><span class="line">		return EMPTY_ARGS;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	Object[] args = new Object[parameters.length];</span><br><span class="line">	for (int i = 0; i &lt; parameters.length; i++) &#123;</span><br><span class="line">		MethodParameter parameter = parameters[i];</span><br><span class="line">		parameter.initParameterNameDiscovery(this.parameterNameDiscoverer);</span><br><span class="line">		args[i] = findProvidedArgument(parameter, providedArgs);</span><br><span class="line">		if (args[i] != null) &#123;</span><br><span class="line">			continue;</span><br><span class="line">		&#125;</span><br><span class="line">		if (!this.resolvers.supportsParameter(parameter)) &#123;</span><br><span class="line">			throw new IllegalStateException(formatArgumentError(parameter, &quot;No suitable resolver&quot;));</span><br><span class="line">		&#125;</span><br><span class="line">		try &#123;</span><br><span class="line">			args[i] = this.resolvers.resolveArgument(parameter, mavContainer, request, this.dataBinderFactory);</span><br><span class="line">		&#125;</span><br><span class="line">		catch (Exception ex) &#123;</span><br><span class="line">			// Leave stack trace for later, exception may actually be resolved and handled...</span><br><span class="line">			if (logger.isDebugEnabled()) &#123;</span><br><span class="line">				String exMsg = ex.getMessage();</span><br><span class="line">				if (exMsg != null &amp;&amp; !exMsg.contains(parameter.getExecutable().toGenericString())) &#123;</span><br><span class="line">					logger.debug(formatArgumentError(parameter, exMsg));</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			throw ex;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	return args;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.imder.top/2022/02/21/ExceptionHandler%E5%92%8CControllerAdvice%E6%B3%A8%E8%A7%A3%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Ren zheng xiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2022/02/21/ExceptionHandler%E5%92%8CControllerAdvice%E6%B3%A8%E8%A7%A3%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">ExceptionHandler和ControllerAdvice注解分析</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-02-21 18:59:29" itemprop="dateCreated datePublished" datetime="2022-02-21T18:59:29+00:00">2022-02-21</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2024-03-28 16:43:20" itemprop="dateModified" datetime="2024-03-28T16:43:20+00:00">2024-03-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JAVA/" itemprop="url" rel="index"><span itemprop="name">JAVA</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/JAVA/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ExceptionHandler和ControllerAdvice注解分析"><a href="#ExceptionHandler和ControllerAdvice注解分析" class="headerlink" title="ExceptionHandler和ControllerAdvice注解分析"></a>ExceptionHandler和ControllerAdvice注解分析</h1><h2 id="DispatcherServlet如何加载HandlerExceptionResolver？"><a href="#DispatcherServlet如何加载HandlerExceptionResolver？" class="headerlink" title="DispatcherServlet如何加载HandlerExceptionResolver？"></a>DispatcherServlet如何加载HandlerExceptionResolver？</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">private void initHandlerExceptionResolvers(ApplicationContext context) &#123;</span><br><span class="line">		this.handlerExceptionResolvers = null;</span><br><span class="line"></span><br><span class="line">		if (this.detectAllHandlerExceptionResolvers) &#123; //默认为true</span><br><span class="line">			// Find all HandlerExceptionResolvers in the ApplicationContext, including ancestor contexts.</span><br><span class="line">			Map&lt;String, HandlerExceptionResolver&gt; matchingBeans = BeanFactoryUtils</span><br><span class="line">					.beansOfTypeIncludingAncestors(context, HandlerExceptionResolver.class, true, false);</span><br><span class="line">			if (!matchingBeans.isEmpty()) &#123;</span><br><span class="line">				this.handlerExceptionResolvers = new ArrayList&lt;&gt;(matchingBeans.values());</span><br><span class="line">				// We keep HandlerExceptionResolvers in sorted order.</span><br><span class="line">				AnnotationAwareOrderComparator.sort(this.handlerExceptionResolvers);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		else &#123;</span><br><span class="line">			try &#123;</span><br><span class="line">				HandlerExceptionResolver her =</span><br><span class="line">						context.getBean(HANDLER_EXCEPTION_RESOLVER_BEAN_NAME, HandlerExceptionResolver.class);</span><br><span class="line">				this.handlerExceptionResolvers = Collections.singletonList(her);</span><br><span class="line">			&#125;</span><br><span class="line">			catch (NoSuchBeanDefinitionException ex) &#123;</span><br><span class="line">				// Ignore, no HandlerExceptionResolver is fine too.</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		// Ensure we have at least some HandlerExceptionResolvers, by registering</span><br><span class="line">		// default HandlerExceptionResolvers if no other resolvers are found.</span><br><span class="line">		if (this.handlerExceptionResolvers == null) &#123;</span><br><span class="line">			this.handlerExceptionResolvers = getDefaultStrategies(context, HandlerExceptionResolver.class); //从默认的DispatcherServlet.properties取</span><br><span class="line">			if (logger.isTraceEnabled()) &#123;</span><br><span class="line">				logger.trace(&quot;No HandlerExceptionResolvers declared in servlet &#x27;&quot; + getServletName() +</span><br><span class="line">						&quot;&#x27;: using default strategies from DispatcherServlet.properties&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DispatcherServlet-properties里的HandlerExceptionResolver配置"><a href="#DispatcherServlet-properties里的HandlerExceptionResolver配置" class="headerlink" title="DispatcherServlet.properties里的HandlerExceptionResolver配置"></a>DispatcherServlet.properties里的HandlerExceptionResolver配置</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.web.servlet.HandlerExceptionResolver=org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver,\</span><br><span class="line">	org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,\</span><br><span class="line">	org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver</span><br></pre></td></tr></table></figure>

<h2 id="何时加载-ControllerAdvice注解的bean、-ExceptionHandler注解的方法"><a href="#何时加载-ControllerAdvice注解的bean、-ExceptionHandler注解的方法" class="headerlink" title="何时加载@ControllerAdvice注解的bean、@ExceptionHandler注解的方法?"></a>何时加载@ControllerAdvice注解的bean、@ExceptionHandler注解的方法?</h2><ul>
<li>ExceptionHandlerExceptionResolver实现InitializingBean接口，在afterPropertiesSet方法里调用initExceptionHandlerAdviceCache()方法</li>
<li>在initExceptionHandlerAdviceCache()方法里对@ControllerAdvice注解的bean、@ExceptionHandler注解的方法进行处理</li>
<li>找出所有带有@ControllerAdvice注解的bean，用ExceptionHandlerMethodResolver类判断bean上是否有@ExceptionHandler，有加入exceptionHandlerAdviceCache里</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">private void initExceptionHandlerAdviceCache() &#123;</span><br><span class="line">		if (getApplicationContext() == null) &#123;</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		List&lt;ControllerAdviceBean&gt; adviceBeans = ControllerAdviceBean.findAnnotatedBeans(getApplicationContext()); //找出所有带有@ControllerAdvice注解的bean</span><br><span class="line">		for (ControllerAdviceBean adviceBean : adviceBeans) &#123;</span><br><span class="line">			Class&lt;?&gt; beanType = adviceBean.getBeanType();</span><br><span class="line">			if (beanType == null) &#123;</span><br><span class="line">				throw new IllegalStateException(&quot;Unresolvable type for ControllerAdviceBean: &quot; + adviceBean);</span><br><span class="line">			&#125;</span><br><span class="line">			ExceptionHandlerMethodResolver resolver = new ExceptionHandlerMethodResolver(beanType);</span><br><span class="line">			if (resolver.hasExceptionMappings()) &#123;</span><br><span class="line">				this.exceptionHandlerAdviceCache.put(adviceBean, resolver);</span><br><span class="line">			&#125;</span><br><span class="line">			if (ResponseBodyAdvice.class.isAssignableFrom(beanType)) &#123;</span><br><span class="line">				this.responseBodyAdvice.add(adviceBean);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		if (logger.isDebugEnabled()) &#123;</span><br><span class="line">			int handlerSize = this.exceptionHandlerAdviceCache.size();</span><br><span class="line">			int adviceSize = this.responseBodyAdvice.size();</span><br><span class="line">			if (handlerSize == 0 &amp;&amp; adviceSize == 0) &#123;</span><br><span class="line">				logger.debug(&quot;ControllerAdvice beans: none&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">			else &#123;</span><br><span class="line">				logger.debug(&quot;ControllerAdvice beans: &quot; +</span><br><span class="line">						handlerSize + &quot; @ExceptionHandler, &quot; + adviceSize + &quot; ResponseBodyAdvice&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>将@ControllerAdvice注解的bean解析方法上ExceptionHandler注解并放入mappedMethods中</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public static final MethodFilter EXCEPTION_HANDLER_METHODS = method -&gt;</span><br><span class="line">			AnnotatedElementUtils.hasAnnotation(method, ExceptionHandler.class);</span><br><span class="line">			</span><br><span class="line">public ExceptionHandlerMethodResolver(Class&lt;?&gt; handlerType) &#123;</span><br><span class="line">		for (Method method : MethodIntrospector.selectMethods(handlerType, EXCEPTION_HANDLER_METHODS)) &#123;</span><br><span class="line">			for (Class&lt;? extends Throwable&gt; exceptionType : detectExceptionMappings(method)) &#123;</span><br><span class="line">				addExceptionMapping(exceptionType, method);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">private void addExceptionMapping(Class&lt;? extends Throwable&gt; exceptionType, Method method) &#123;</span><br><span class="line">		Method oldMethod = this.mappedMethods.put(exceptionType, method);</span><br><span class="line">		if (oldMethod != null &amp;&amp; !oldMethod.equals(method)) &#123;</span><br><span class="line">			throw new IllegalStateException(&quot;Ambiguous @ExceptionHandler method mapped for [&quot; +</span><br><span class="line">					exceptionType + &quot;]: &#123;&quot; + oldMethod + &quot;, &quot; + method + &quot;&#125;&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public boolean hasExceptionMappings() &#123;</span><br><span class="line">	return !this.mappedMethods.isEmpty();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="何时调用到ExceptionHandlerExceptionResolver"><a href="#何时调用到ExceptionHandlerExceptionResolver" class="headerlink" title="何时调用到ExceptionHandlerExceptionResolver?"></a>何时调用到ExceptionHandlerExceptionResolver?</h2><p>– 在DispatcherServlet的doDispatch方法中try-catch的catch代码中调用processDispatchResult方法(),这个方法中调用了processHandlerException方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception &#123;</span><br><span class="line">		HttpServletRequest processedRequest = request;</span><br><span class="line">		HandlerExecutionChain mappedHandler = null;</span><br><span class="line">		boolean multipartRequestParsed = false;</span><br><span class="line"></span><br><span class="line">		WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</span><br><span class="line"></span><br><span class="line">		try &#123;</span><br><span class="line">			ModelAndView mv = null;</span><br><span class="line">			Exception dispatchException = null;</span><br><span class="line">			....省略</span><br><span class="line">			catch (Exception ex) &#123;</span><br><span class="line">				dispatchException = ex;</span><br><span class="line">			&#125;</span><br><span class="line">			catch (Throwable err) &#123;</span><br><span class="line">				// As of 4.3, we&#x27;re processing Errors thrown from handler methods as well,</span><br><span class="line">				// making them available for @ExceptionHandler methods and other scenarios.</span><br><span class="line">				dispatchException = new NestedServletException(&quot;Handler dispatch failed&quot;, err);</span><br><span class="line">			&#125;</span><br><span class="line">			processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br><span class="line">		&#125;</span><br><span class="line">		...</span><br><span class="line">&#125;</span><br><span class="line">private void processDispatchResult(HttpServletRequest request, HttpServletResponse response,</span><br><span class="line">			@Nullable HandlerExecutionChain mappedHandler, @Nullable ModelAndView mv,</span><br><span class="line">			@Nullable Exception exception) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">		boolean errorView = false;</span><br><span class="line"></span><br><span class="line">		if (exception != null) &#123;</span><br><span class="line">			if (exception instanceof ModelAndViewDefiningException) &#123;</span><br><span class="line">				logger.debug(&quot;ModelAndViewDefiningException encountered&quot;, exception);</span><br><span class="line">				mv = ((ModelAndViewDefiningException) exception).getModelAndView();</span><br><span class="line">			&#125;</span><br><span class="line">			else &#123;</span><br><span class="line">				Object handler = (mappedHandler != null ? mappedHandler.getHandler() : null);</span><br><span class="line">				mv = processHandlerException(request, response, handler, exception);</span><br><span class="line">				errorView = (mv != null);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		....省略</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">protected ModelAndView processHandlerException(HttpServletRequest request, HttpServletResponse response,</span><br><span class="line">			@Nullable Object handler, Exception ex) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">		// Success and error responses may use different content types</span><br><span class="line">		request.removeAttribute(HandlerMapping.PRODUCIBLE_MEDIA_TYPES_ATTRIBUTE);</span><br><span class="line"></span><br><span class="line">		// Check registered HandlerExceptionResolvers...</span><br><span class="line">		ModelAndView exMv = null;</span><br><span class="line">		//遍历所有的handlerExceptionResolvers，能resolveException返回不空为空跳出循环</span><br><span class="line">		if (this.handlerExceptionResolvers != null) &#123;</span><br><span class="line">			for (HandlerExceptionResolver resolver : this.handlerExceptionResolvers) &#123;</span><br><span class="line">				exMv = resolver.resolveException(request, response, handler, ex);//此处调用ExceptionHandlerExceptionResolver的resolveException方法</span><br><span class="line">				if (exMv != null) &#123;</span><br><span class="line">					break;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		....省略</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="调用ExceptionHandlerExceptionResolver的resolveException方法如何处理异常"><a href="#调用ExceptionHandlerExceptionResolver的resolveException方法如何处理异常" class="headerlink" title="调用ExceptionHandlerExceptionResolver的resolveException方法如何处理异常"></a>调用ExceptionHandlerExceptionResolver的resolveException方法如何处理异常</h2><ul>
<li>resolveException方法会调用doResolveHandlerMethodException方法</li>
<li>在doResolveHandlerMethodException方法里<ul>
<li>调用getExceptionHandlerMethod方法里<ul>
<li>从当前controller类找ExceptionHandler注解的方法，若找到并匹配异常类型返回ServletInvocableHandlerMethod</li>
<li>从exceptionHandlerAdviceCache 里面找到方法并匹配异常类型返回ServletInvocableHandlerMethod</li>
</ul>
</li>
<li>对返回的getExceptionHandlerMethod方法返回值进行判断<ul>
<li>不为空 exceptionHandlerMethod.invokeAndHandle(webRequest, mavContainer, arguments);</li>
<li>为空 return null</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">protected ModelAndView doResolveHandlerMethodException(HttpServletRequest request,</span><br><span class="line">			HttpServletResponse response, @Nullable HandlerMethod handlerMethod, Exception exception) &#123;</span><br><span class="line"></span><br><span class="line">		ServletInvocableHandlerMethod exceptionHandlerMethod = getExceptionHandlerMethod(handlerMethod, exception);</span><br><span class="line">		if (exceptionHandlerMethod == null) &#123;</span><br><span class="line">			return null;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		...省略</span><br><span class="line">		ServletWebRequest webRequest = new ServletWebRequest(request, response);</span><br><span class="line">		ModelAndViewContainer mavContainer = new ModelAndViewContainer();</span><br><span class="line"></span><br><span class="line">		ArrayList&lt;Throwable&gt; exceptions = new ArrayList&lt;&gt;();</span><br><span class="line">		try &#123;</span><br><span class="line">			...省略</span><br><span class="line">			exceptionHandlerMethod.invokeAndHandle(webRequest, mavContainer, arguments);</span><br><span class="line">		&#125;</span><br><span class="line">		catch (Throwable invocationEx) &#123;</span><br><span class="line">			// Any other than the original exception (or a cause) is unintended here,</span><br><span class="line">			// probably an accident (e.g. failed assertion or the like).</span><br><span class="line">			if (!exceptions.contains(invocationEx) &amp;&amp; logger.isWarnEnabled()) &#123;</span><br><span class="line">				logger.warn(&quot;Failure in @ExceptionHandler &quot; + exceptionHandlerMethod, invocationEx);</span><br><span class="line">			&#125;</span><br><span class="line">			// Continue with default processing of the original exception...</span><br><span class="line">			return null;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		if (mavContainer.isRequestHandled()) &#123;</span><br><span class="line">			return new ModelAndView();</span><br><span class="line">		&#125;</span><br><span class="line">		else &#123;</span><br><span class="line">			ModelMap model = mavContainer.getModel();</span><br><span class="line">			HttpStatus status = mavContainer.getStatus();</span><br><span class="line">			ModelAndView mav = new ModelAndView(mavContainer.getViewName(), model, status);</span><br><span class="line">			mav.setViewName(mavContainer.getViewName());</span><br><span class="line">			if (!mavContainer.isViewReference()) &#123;</span><br><span class="line">				mav.setView((View) mavContainer.getView());</span><br><span class="line">			&#125;</span><br><span class="line">			if (model instanceof RedirectAttributes) &#123;</span><br><span class="line">				Map&lt;String, ?&gt; flashAttributes = ((RedirectAttributes) model).getFlashAttributes();</span><br><span class="line">				RequestContextUtils.getOutputFlashMap(request).putAll(flashAttributes);</span><br><span class="line">			&#125;</span><br><span class="line">			return mav;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	protected ServletInvocableHandlerMethod getExceptionHandlerMethod(</span><br><span class="line">			@Nullable HandlerMethod handlerMethod, Exception exception) &#123;</span><br><span class="line"></span><br><span class="line">		Class&lt;?&gt; handlerType = null;</span><br><span class="line"></span><br><span class="line">		if (handlerMethod != null) &#123;</span><br><span class="line">			// Local exception handler methods on the controller class itself.</span><br><span class="line">			// To be invoked through the proxy, even in case of an interface-based proxy.</span><br><span class="line">			handlerType = handlerMethod.getBeanType();</span><br><span class="line">			ExceptionHandlerMethodResolver resolver = this.exceptionHandlerCache.get(handlerType);</span><br><span class="line">			if (resolver == null) &#123;</span><br><span class="line">				resolver = new ExceptionHandlerMethodResolver(handlerType);</span><br><span class="line">				this.exceptionHandlerCache.put(handlerType, resolver);</span><br><span class="line">			&#125;</span><br><span class="line">			Method method = resolver.resolveMethod(exception);//从当前controller类找ExceptionHandler注解的方法</span><br><span class="line">			if (method != null) &#123;</span><br><span class="line">				return new ServletInvocableHandlerMethod(handlerMethod.getBean(), method, this.applicationContext);</span><br><span class="line">			&#125;</span><br><span class="line">			// For advice applicability check below (involving base packages, assignable types</span><br><span class="line">			// and annotation presence), use target class instead of interface-based proxy.</span><br><span class="line">			if (Proxy.isProxyClass(handlerType)) &#123;</span><br><span class="line">				handlerType = AopUtils.getTargetClass(handlerMethod.getBean());</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		for (Map.Entry&lt;ControllerAdviceBean, ExceptionHandlerMethodResolver&gt; entry : this.exceptionHandlerAdviceCache.entrySet()) &#123;</span><br><span class="line">			ControllerAdviceBean advice = entry.getKey();</span><br><span class="line">			if (advice.isApplicableToBeanType(handlerType)) &#123;</span><br><span class="line">				ExceptionHandlerMethodResolver resolver = entry.getValue();</span><br><span class="line">				Method method = resolver.resolveMethod(exception);//从exceptionHandlerAdviceCache 里面找到并匹配异常类型</span><br><span class="line">				if (method != null) &#123;</span><br><span class="line">					return new ServletInvocableHandlerMethod(advice.resolveBean(), method, this.applicationContext);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		return null;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void invokeAndHandle(ServletWebRequest webRequest, ModelAndViewContainer mavContainer,</span><br><span class="line">			Object... providedArgs) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">		Object returnValue = invokeForRequest(webRequest, mavContainer, providedArgs);</span><br><span class="line">		setResponseStatus(webRequest);</span><br><span class="line"></span><br><span class="line">		if (returnValue == null) &#123;</span><br><span class="line">			if (isRequestNotModified(webRequest) || getResponseStatus() != null || mavContainer.isRequestHandled()) &#123;</span><br><span class="line">				disableContentCachingIfNecessary(webRequest);</span><br><span class="line">				mavContainer.setRequestHandled(true);</span><br><span class="line">				return;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		else if (StringUtils.hasText(getResponseStatusReason())) &#123;</span><br><span class="line">			mavContainer.setRequestHandled(true);</span><br><span class="line">			return;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		mavContainer.setRequestHandled(false);</span><br><span class="line">		Assert.state(this.returnValueHandlers != null, &quot;No return value handlers&quot;);</span><br><span class="line">		try &#123;</span><br><span class="line">			this.returnValueHandlers.handleReturnValue(</span><br><span class="line">					returnValue, getReturnValueType(returnValue), mavContainer, webRequest);</span><br><span class="line">		&#125;</span><br><span class="line">		catch (Exception ex) &#123;</span><br><span class="line">			if (logger.isTraceEnabled()) &#123;</span><br><span class="line">				logger.trace(formatErrorForReturnValue(returnValue), ex);</span><br><span class="line">			&#125;</span><br><span class="line">			throw ex;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.imder.top/2021/11/30/huawei_lj16/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Ren zheng xiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/30/huawei_lj16/" class="post-title-link" itemprop="url">LJ16购物单</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-30 11:43:00" itemprop="dateCreated datePublished" datetime="2021-11-30T11:43:00+00:00">2021-11-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2024-03-28 16:43:20" itemprop="dateModified" datetime="2024-03-28T16:43:20+00:00">2024-03-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%8E%E4%B8%BA%E9%9D%A2%E8%AF%95%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">华为面试题</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="购物单"><a href="#购物单" class="headerlink" title="购物单"></a>购物单</h1><h1 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h1><p>王强今天很开心，公司发给N元的年终奖。王强决定把年终奖用于购物，他把想买的物品分为两类：主件与附件，附件是从属于某个主件的，下表就是一些主件与附件的例子：</p>
<table>
<thead>
<tr>
<th align="center">主件</th>
<th align="center">附件</th>
</tr>
</thead>
<tbody><tr>
<td align="center">电脑</td>
<td align="center">打印机，扫描仪</td>
</tr>
<tr>
<td align="center">书柜</td>
<td align="center">图书</td>
</tr>
<tr>
<td align="center">书桌</td>
<td align="center">台灯文具</td>
</tr>
<tr>
<td align="center">工作椅</td>
<td align="center">无</td>
</tr>
</tbody></table>
<p>如果要买归类为附件的物品，必须先买该附件所属的主件。每个主件可以有 0 个、 1 个或 2 个附件。附件不再有从属于自己的附件。王强想买的东西很多，为了不超出预算，他把每件物品规定了一个重要度，分为 5 等：用整数 1 ~ 5 表示，第 5 等最重要。他还从因特网上查到了每件物品的价格（都是 10 元的整数倍）。他希望在不超过 N 元（可以等于 N 元）的前提下，使每件物品的价格与重要度的乘积的总和最大。<br>    设第 j 件物品的价格为 v[j] ，重要度为 w[j] ，共选中了 k 件物品，编号依次为 j 1 ， j 2 ，……， j k ，则所求的总和为：<br>v[j 1 ]*w[j 1 ]+v[j 2 ]*w[j 2 ]+ … +v[j k ]*w[j k ] 。（其中 * 为乘号）<br>    请你帮助王强设计一个满足要求的购物单。</p>
<h2 id="输入描述："><a href="#输入描述：" class="headerlink" title="输入描述："></a>输入描述：</h2><p>输入的第 1 行，为两个正整数，用一个空格隔开：N m<br>（其中 N （ &lt;32000 ）表示总钱数， m （ &lt;60 ）为希望购买物品的个数。）</p>
<p>从第 2 行到第 m+1 行，第 j 行给出了编号为 j-1 的物品的基本数据，每行有 3 个非负整数 v p q</p>
<p>（其中 v 表示该物品的价格（ v&lt;10000 ）， p 表示该物品的重要度（ 1 ~ 5 ）， q 表示该物品是主件还是附件。如果 q=0 ，表示该物品为主件，如果 q&gt;0 ，表示该物品为附件， q 是所属主件的编号）</p>
<h2 id="输出描述："><a href="#输出描述：" class="headerlink" title="输出描述："></a>输出描述：</h2><p> 输出文件只有一个正整数，为不超过总钱数的物品的价格与重要度乘积的总和的最大值（ &lt;200000 ）。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.imder.top/2021/11/30/huawei_lj15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Ren zheng xiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/30/huawei_lj15/" class="post-title-link" itemprop="url">LJ15求int型正整数在内存中存储时1的个数</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-30 11:42:00" itemprop="dateCreated datePublished" datetime="2021-11-30T11:42:00+00:00">2021-11-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2024-03-28 16:43:20" itemprop="dateModified" datetime="2024-03-28T16:43:20+00:00">2024-03-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%8E%E4%B8%BA%E9%9D%A2%E8%AF%95%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">华为面试题</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="求int型正整数在内存中存储时1的个数"><a href="#求int型正整数在内存中存储时1的个数" class="headerlink" title="求int型正整数在内存中存储时1的个数"></a>求int型正整数在内存中存储时1的个数</h1><h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>输入一个 int 型的正整数，计算出该 int 型数据在内存中存储时 1 的个数。</p>
<p>数据范围：保证在 32 位整型数字范围内</p>
<h2 id="输入描述："><a href="#输入描述：" class="headerlink" title="输入描述："></a>输入描述：</h2><p> 输入一个整数（int类型）</p>
<h2 id="输出描述："><a href="#输出描述：" class="headerlink" title="输出描述："></a>输出描述：</h2><p> 这个数转换成2进制后，输出1的个数</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> import java.util.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author renzhengxiao</span><br><span class="line"> */</span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Scanner scanner = new Scanner(System.in);</span><br><span class="line">        int n = scanner.nextInt();</span><br><span class="line">        scanner.nextLine();</span><br><span class="line">        String s = Integer.toString(n, 2);</span><br><span class="line">        int length = s.replaceAll(&quot;[^1]&quot;, &quot;&quot;).length();</span><br><span class="line">        System.out.println(length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.imder.top/2021/11/30/huawei_lj14/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Ren zheng xiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/30/huawei_lj14/" class="post-title-link" itemprop="url">LJ14字符串排序</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-30 11:41:00" itemprop="dateCreated datePublished" datetime="2021-11-30T11:41:00+00:00">2021-11-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2024-03-28 16:43:20" itemprop="dateModified" datetime="2024-03-28T16:43:20+00:00">2024-03-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%8E%E4%B8%BA%E9%9D%A2%E8%AF%95%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">华为面试题</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="字符串排序"><a href="#字符串排序" class="headerlink" title="字符串排序"></a>字符串排序</h1><h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>给定 n 个字符串，请对 n 个字符串按照字典序排列。</p>
<h2 id="输入描述："><a href="#输入描述：" class="headerlink" title="输入描述："></a>输入描述：</h2><p>输入第一行为一个正整数n(1≤n≤1000),下面n行为n个字符串(字符串长度≤100),字符串中只含有大小写字母。</p>
<h2 id="输出描述："><a href="#输出描述：" class="headerlink" title="输出描述："></a>输出描述：</h2><p>数据输出n行，输出结果为按照字典序排列的字符串。</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import java.util.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author renzhengxiao</span><br><span class="line"> */</span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Scanner scanner = new Scanner(System.in);</span><br><span class="line">        int n = scanner.nextInt();</span><br><span class="line">        scanner.nextLine();</span><br><span class="line">        List&lt;String&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">        for (int i = 0; i &lt; n; i++) &#123;</span><br><span class="line">            String s = scanner.nextLine();</span><br><span class="line">            list.add(s);</span><br><span class="line">        &#125;</span><br><span class="line">        list.sort(new Comparator&lt;String&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public int compare(String o1, String o2) &#123;</span><br><span class="line">                return o1.compareTo(o2);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        for (String c : list) &#123;</span><br><span class="line">            System.out.println(c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.imder.top/2021/11/30/huawei_lj13/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Ren zheng xiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/30/huawei_lj13/" class="post-title-link" itemprop="url">LJ13句子逆序</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-30 11:40:00" itemprop="dateCreated datePublished" datetime="2021-11-30T11:40:00+00:00">2021-11-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2024-03-28 16:43:20" itemprop="dateModified" datetime="2024-03-28T16:43:20+00:00">2024-03-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%8E%E4%B8%BA%E9%9D%A2%E8%AF%95%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">华为面试题</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="句子逆序"><a href="#句子逆序" class="headerlink" title="句子逆序"></a>句子逆序</h1><h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>将一个英文语句以单词为单位逆序排放。例如“I am a boy”，逆序排放后为“boy a am I”<br>所有单词之间用一个空格隔开，语句中除了英文字母外，不再包含其他字符</p>
<p>数据范围：输入的字符串长度满足 </p>
<p>注意本题有多组输入</p>
<h2 id="输入描述："><a href="#输入描述：" class="headerlink" title="输入描述："></a>输入描述：</h2><p>输入一个英文语句，每个单词用空格隔开。保证输入只包含空格和字母。</p>
<h2 id="输出描述："><a href="#输出描述：" class="headerlink" title="输出描述："></a>输出描述：</h2><p>得到逆序的句子</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import java.util.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author renzhengxiao</span><br><span class="line"> */</span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Scanner scanner = new Scanner(System.in);</span><br><span class="line">        String num = scanner.nextLine();</span><br><span class="line">        String[] s = num.split(&quot; &quot;);</span><br><span class="line">        List&lt;String&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">        for (String c : s) &#123;</span><br><span class="line">            list.add(c);</span><br><span class="line">        &#125;</span><br><span class="line">        Collections.reverse(list);</span><br><span class="line">        String result = &quot;&quot;;</span><br><span class="line">        for (int i = 0; i &lt; list.size(); i++) &#123;</span><br><span class="line">            result += list.get(i);</span><br><span class="line">            if (i + 1 != list.size()) &#123;</span><br><span class="line">                result += &quot; &quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.imder.top/2021/11/30/huawei_lj12/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Ren zheng xiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/30/huawei_lj12/" class="post-title-link" itemprop="url">LJ12字符串反转</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-30 11:30:00" itemprop="dateCreated datePublished" datetime="2021-11-30T11:30:00+00:00">2021-11-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2024-03-28 16:43:20" itemprop="dateModified" datetime="2024-03-28T16:43:20+00:00">2024-03-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%8E%E4%B8%BA%E9%9D%A2%E8%AF%95%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">华为面试题</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="字符串反转"><a href="#字符串反转" class="headerlink" title="字符串反转"></a>字符串反转</h1><h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>接受一个只包含小写字母的字符串，然后输出该字符串反转后的字符串。（字符串长度不超过1000）</p>
<h2 id="输入描述："><a href="#输入描述：" class="headerlink" title="输入描述："></a>输入描述：</h2><p>输入一行，为一个只包含小写字母的字符串。</p>
<h2 id="输出描述："><a href="#输出描述：" class="headerlink" title="输出描述："></a>输出描述：</h2><p>输出该字符串反转后的字符串。</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import java.util.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author renzhengxiao</span><br><span class="line"> */</span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Scanner scanner = new Scanner(System.in);</span><br><span class="line">        String num = scanner.nextLine();</span><br><span class="line">        System.out.println(new StringBuilder(num).reverse().toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.imder.top/2021/11/30/huawei_lj11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Ren zheng xiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/30/huawei_lj11/" class="post-title-link" itemprop="url">LJ11数字颠倒</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-30 11:20:00" itemprop="dateCreated datePublished" datetime="2021-11-30T11:20:00+00:00">2021-11-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2024-03-28 16:43:20" itemprop="dateModified" datetime="2024-03-28T16:43:20+00:00">2024-03-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%8E%E4%B8%BA%E9%9D%A2%E8%AF%95%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">华为面试题</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="数字颠倒"><a href="#数字颠倒" class="headerlink" title="数字颠倒"></a>数字颠倒</h1><h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>输入一个整数，将这个整数以字符串的形式逆序输出<br>程序不考虑负数的情况，若数字含有0，则逆序形式也含有0，如输入为100，则输出为001</p>
<h2 id="输入描述："><a href="#输入描述：" class="headerlink" title="输入描述："></a>输入描述：</h2><p>输入一个int整数</p>
<h2 id="输出描述："><a href="#输出描述：" class="headerlink" title="输出描述："></a>输出描述：</h2><p>将这个整数以字符串的形式逆序输出</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import java.util.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author renzhengxiao</span><br><span class="line"> */</span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Scanner scanner = new Scanner(System.in);</span><br><span class="line">        String num = scanner.nextLine();</span><br><span class="line">        System.out.println(new StringBuilder(num).reverse().toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://blog.imder.top/2021/11/30/huawei_lj10/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Ren zheng xiao">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="随记">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/30/huawei_lj10/" class="post-title-link" itemprop="url">LJ10字符个数统计</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-30 11:10:00" itemprop="dateCreated datePublished" datetime="2021-11-30T11:10:00+00:00">2021-11-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2024-03-28 16:43:20" itemprop="dateModified" datetime="2024-03-28T16:43:20+00:00">2024-03-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%8E%E4%B8%BA%E9%9D%A2%E8%AF%95%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">华为面试题</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="字符个数统计"><a href="#字符个数统计" class="headerlink" title="字符个数统计"></a>字符个数统计</h1><h2 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h2><p>编写一个函数，计算字符串中含有的不同字符的个数。字符在 ASCII 码范围内( 0~127 ，包括 0 和 127 )，换行表示结束符，不算在字符里。不在范围内的不作统计。多个相同的字符只计算一次<br>例如，对于字符串 abaca 而言，有 a、b、c 三种不同的字符，因此输出 3 。</p>
<p>数据范围： </p>
<h2 id="输入描述："><a href="#输入描述：" class="headerlink" title="输入描述："></a>输入描述：</h2><p>输入一行没有空格的字符串。</p>
<h2 id="输出描述："><a href="#输出描述：" class="headerlink" title="输出描述："></a>输出描述：</h2><p>输出 输入字符串 中范围在(0~127，包括0和127)字符的种数。</p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import java.util.*;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * author renzhengxiao</span><br><span class="line"> */</span><br><span class="line">public class Main &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Scanner scanner = new Scanner(System.in);</span><br><span class="line">        String num = scanner.nextLine();</span><br><span class="line">        Set&lt;Character&gt; sets = new HashSet&lt;&gt;();</span><br><span class="line">        for (char c : num.toCharArray()) &#123;</span><br><span class="line">            sets.add(c);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(sets.size());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">苏ICP备14022081号-4 </a>
  </div>

<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ren zheng xiao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
